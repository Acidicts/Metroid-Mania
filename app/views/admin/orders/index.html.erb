<div class="admin-panel">
  <h1>Orders</h1>
    <%= form_with url: admin_orders_path, method: :get, local: true do |f| %>
      <%= f.text_field :q, placeholder: 'Order ID or email or product name', value: params[:q], style: 'padding:6px; width:260px' %>
      <%= f.submit 'Search', class: 'btn-retro-admin', style: 'font-size: 1.1rem; font-family: "Pixelify Sans"; margin-left:6px' %>
      <% if params[:q].present? %>
        <%= link_to 'Clear', admin_orders_path, class: 'btn-retro-admin', style: 'margin-left:6px' %>
      <% end %>
    <% end %>

    <div style="margin-left:auto; font-size:0.9rem; color: #666;">Showing <%= @orders.count %> orders</div>
  </div>

  <table class="admin-table compact">
    <thead>
      <tr>
        <th style="width:24%">User</th>
        <th class="status-col">Status</th>
      </tr>
    </thead>
    <tbody>
      <% @orders.each do |o| %>
        <%if o.user.name != "Deleted User" %>
          <tr class="admin-table-row">
            <td class="order-info">
              <div><%= o.user.name %></div>
              <div style="font-size:0.85rem; color: var(--admin-700);"><%= o.user.slack_id %></div>
            </td>

            <td class="order-info">
              <div style="display:flex; align-items:center; gap:8px; justify-content:space-between;">
                <div>
                  <div><%= o.name %> <span class="order-item-badge"><%= o.cost %></span></div>
                  <div style="font-size:0.85rem; color: #666;">ID: <%= o.public_id || o.id %></div>
                </div>
                <div style="display:flex; align-items:center; gap:12px;">
                  <div class="status-badge <%= case o.status.to_s
                    when 'pending' then 'status-pending'
                    when 'denied','declined' then 'status-denied'
                    when 'fulfilled','completed' then 'status-fulfilled'
                    else 'status-pending' end %>"><%= o.status.to_s.humanize %></div>
                  <div class="order-actions-box">
                    <% if o.status == "pending" || o.status == "shipped" %>
                      <%= button_to "Fulfill", fulfill_admin_order_path(o), method: :post, class: 'btn-retro-admin' %>
                      <%= button_to "Decline & Refund", decline_admin_order_path(o), method: :post, data: { confirm: 'Refund user and decline order?' }, class: 'btn-retro-admin' %>
                    <% else %>
                      <%= button_to "Fulfill", fulfill_admin_order_path(o), method: :post, class: 'btn-retro-admin-disabled', disabled: true %>
                      <%= button_to "Decline & Refund", decline_admin_order_path(o), method: :post, data: { confirm: 'Refund user and decline order?' }, class: 'btn-retro-admin-disabled', disabled: true %>
                    <% end %>
                    <%= link_to 'View', admin_order_path(o), class: 'btn-retro-admin' %>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

    </div> <!-- admin-panel -->
