<p style="color: green"><%= notice %></p>

<%= render @project %>

<hr>

<div class="devlogs-section">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Devlogs</h2>
    <%= link_to "New Devlog", new_project_devlog_path(@project), class: "btn btn-primary" %>
  </div>

  <% if @project.devlogs.any? %>
    <%= render @project.devlogs.order(log_date: :desc) %>
  <% else %>
    <p>No devlogs yet. Document your progress!</p>
  <% end %>
</div>

<hr>

<div>
  <%= link_to "Edit this project", edit_project_path(@project) %> |
  <%= link_to "Back to projects", projects_path %>

  <% if @project.user == current_user %>
    <% if @project.shipped? %>
      <p><strong>Status:</strong> Shipped âœ…</p>
      <%# Allow another request only if there's a devlog after the last approval %>
      <% if @project.approved_at.present? && @project.devlogs.where('created_at >= ?', @project.approved_at).exists? %>
        <%= button_to "Request another ship", ship_project_path(@project), method: :post, data: { confirm: 'Request a new ship?' }, class: 'btn btn-primary' %>
      <% else %>
        <p style="color: #6b7280;">To ship again, add a devlog after approval, then request shipping. <%= link_to "Create a devlog", new_project_devlog_path(@project) %></p>
      <% end %>
    <% elsif @project.ship_requested_at %>
      <p style="color: #b45309;"><strong>Ship requested:</strong> Awaiting admin approval since <%= @project.ship_requested_at %></p>
    <% else %>
      <%= button_to "Request Ship", ship_project_path(@project), method: :post, data: { confirm: 'Request to ship this project?' }, class: 'btn btn-primary' %>
    <% end %>
  <% end %>

  <%= button_to "Destroy this project", @project, method: :delete %>
</div>
